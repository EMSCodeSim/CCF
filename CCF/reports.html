<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CCF Reports</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body class="reportsPage">

<header class="topbar">
  <div class="brand">
    <div class="title">Reports</div>
    <div class="modePill">BLS</div>
  </div>

  <div class="topActions">
    <a class="endBtn ghost" href="./index.html">⬅︎ Timer</a>
  </div>
</header>

<main class="app">
<!-- Upgrade / Pro status (hidden automatically when Pro is unlocked) -->
  <!-- Accordion: Class Setup -->
  <section class="acc" id="accClassSetup">
    <button class="accHead" type="button" data-acc="classSetup">
      <div class="accLeft">
        <div class="accTitle">Class Setup</div>
        <div class="accSub" id="classMeta">Set class info and roster (optional)</div>
      </div>
      <div class="accRight">
        <span class="accChevron" id="chevClassSetup">▾</span>
      </div>
    </button>

    <div class="accBody" id="accBodyClassSetup" style="display:none;">
      <section class="dashCard" id="classSetupPanel" aria-label="Class setup">
        <div class="dashTitle">Class Setup</div>
        <div class="dashSub">Add a roster now (optional email/contact). You can assign scores later.</div>

        <label class="field">
          <span class="fieldLabel">Class name</span>
          <input id="className" type="text" placeholder="RC Health EMT - Skills Day" />
        </label>

        <label class="field">
          <span class="fieldLabel">Instructor</span>
          <input id="instructorName" type="text" placeholder="Instructor name (optional)" />
        </label>

        <label class="field">
          <span class="fieldLabel">Instructor email (optional)</span>
          <input id="instructorEmail" type="email" placeholder="instructor@example.com" />
        </label>


        <div class="row" style="gap:10px;">
          <label class="field" style="margin:0;">
            <span class="fieldLabel">Target CCF %</span>
            <input id="targetCcf" type="number" inputmode="numeric" min="50" max="95" step="1" placeholder="80" />
          </label>

          <label class="field" style="margin:0;">
            <span class="fieldLabel">Session length</span>
            <select id="sessionLengthSec">
              <option value="120">2 minutes</option>
              <option value="300">5 minutes</option>
              <option value="600">10 minutes</option>
              <option value="0">Custom / unknown</option>
            </select>
          </label>
        </div>

        <label class="field">
          <span class="fieldLabel">Location / Notes</span>
          <input id="classLocation" type="text" placeholder="Room / station / notes" />
        </label>
<div class="row" style="justify-content:space-between; align-items:center; margin-top:10px;">
  <div>
    <div class="dashTitle" style="margin:0;">Lock Class Setup</div>
    <div class="dashSub" style="margin:4px 0 0 0;">Prevents accidental edits during testing.</div>
  </div>

  <label class="switch">
    <input id="classLocked" type="checkbox" />
    <span class="slider"></span>
  </label>
</div>

<div class="upgradeNote" id="classLockedNote" style="display:none; margin-top:8px;">
  Class Setup is locked. Turn off “Lock Class Setup” to edit roster or class fields.
</div>



        <div class="dashTitle" style="margin-top:10px;">Roster</div>
        <div class="dashSub">Name required. Email/contact optional. Score optional (leave blank to assign later).</div>
        <div id="rosterEditor" class="rosterEditor" aria-label="Roster editor"></div>

        <div class="studentRow" style="margin-top:10px; align-items:flex-end;">
          <label class="field" style="margin:0; flex:1;">
            <span class="fieldLabel">Quick add student</span>
            <input id="quickAddStudentName" type="text" placeholder="Student name" />
          </label>
          <button class="secondaryBtn" id="btnQuickAddStudent" type="button">Add Student</button>
        </div>

        <div class="row" style="gap:10px; margin-top:12px;">
          <button class="primaryBtn" id="btnSaveClass" type="button">Save Class</button>
          <button class="secondaryBtn" id="btnClearClass" type="button">Clear</button>
        </div>
      </section>
    </div>
  </section>

  <!-- Accordion: Most Recent Score -->
  <section class="acc" id="accLatest">
    <button class="accHead" type="button" data-acc="latest">
      <div class="accLeft">
        <div class="accTitle">Most Recent Score</div>
        <div class="accSub" id="reportSubtitle">Most recent session</div>
      </div>
      <div class="accRight">
        <span class="accMini" id="reportCount">0 saved</span>
        <span class="accChevron" id="chevLatest">▾</span>
      </div>
    </button>

    <div class="accBody" id="accBodyLatest">
      <section class="dashCard" id="latestUnifiedCard" aria-label="Most recent session card">

  <div class="dashTitle">Most Recent CPR Session</div>
  <div class="dashSub" id="latestMetaLine">Most recent session</div>

  <!-- Latest score content (rendered by JS) -->
  <div id="latestCard" class="reportCard" style="margin-top:10px;" aria-label="Latest report"></div>

  <div class="divider" style="margin:12px 0;"></div>

  <!-- Assign block -->
  <div class="dashTitle" style="margin-top:2px;">Assign to student</div>
  <div class="dashSub">Pick a student from the roster or add one right now.</div>

  <div class="studentRow" style="margin-top:10px;">
    <label class="field" style="margin:0; flex:1;">
      <span class="fieldLabel">Assign most recent session to…</span>
      <select id="studentSelect"></select>
    </label>
    <button class="endBtn" id="btnAssignLatest" type="button">Assign</button>
  </div>

  <div class="studentRow" style="margin-top:10px; align-items:flex-end;">
    <label class="field" style="margin:0; flex:1;">
      <span class="fieldLabel">Quick add student</span>
      <input id="latestQuickAddName" type="text" placeholder="Student name" />
    </label>
    <button class="secondaryBtn" id="latestBtnQuickAddAssign" type="button">Add Student</button>
  </div>

  <div class="row" style="gap:10px; margin-top:10px; flex-wrap:wrap;">
    <button class="secondaryBtn" id="btnDownloadLatest" type="button">Download latest report</button>
  </div>

</section>

        </div>
      </section>
    </div>
  </section>

  <!-- Accordion: Class Report -->
  <section class="acc" id="accClassReport">
    <button class="accHead" type="button" data-acc="classReport">
      <div class="accLeft">
        <div class="accTitle">Class Report</div>
        <div class="accSub">Roster, assigned sessions, and scores</div>
      </div>
      <div class="accRight">
        <span class="accChevron" id="chevClassReport">▾</span>
      </div>
    </button>

    <div class="accBody" id="accBodyClassReport" style="display:none;">
      <section class="classDash" aria-label="Class dashboard">
                <div id="classReportStickySummary" class="stickySummary"></div>

<div class="dashGrid">
          <div class="dashCard" id="classScoreCard"></div>
          <div class="dashCard">
            <div class="dashTitle">Class Performance</div>
            <div class="dashSub" id="classChartSub">Average CCF by student</div>
            <div id="classChart" class="classChart" aria-label="Class chart"></div>
          </div>
        </div>

        <div class="dashCard" style="margin-top:12px;">
          <div class="dashTitle">Students</div>
          <div class="dashSub">Click a student to view their full report. You can also enter a manual score.</div>
          <div id="studentTable" class="studentTable"></div>
        </div>

        <div class="dashHint" id="classDashHint" style="display:none;"></div>
      </section>
    </div>
  </section>

  <!-- Accordion: Export -->
  <section class="acc" id="accExport">
    <button class="accHead" type="button" data-acc="export">
      <div class="accLeft">
        <div class="accTitle">Export</div>
        <div class="accSub">Download or email class and student scores</div>
      </div>
      <div class="accRight">
        <span class="accChevron" id="chevExport">▾</span>
      </div>
    </button>

    <div class="accBody" id="accBodyExport" style="display:none;">
      <section class="dashCard" aria-label="Export actions">
        <div class="dashTitle">Export options</div>
        <div class="dashSub">Download files, or generate email drafts for the instructor or students.</div>

        <div class="row" style="gap:10px; flex-wrap:wrap; margin-top:10px;">
          <button class="primaryBtn" id="btnExportCsv" type="button">Download class CSV</button>
          <button class="secondaryBtn" id="btnEmailInstructor" type="button">Email instructor summary</button>
          <button class="secondaryBtn" id="btnEmailStudents" type="button">Email students</button>
        </div>

        <div class="upgradeNote" style="margin-top:10px;">
          Note: mobile email cannot attach files automatically. Use “Download class CSV” then attach it to the email draft if needed.
        </div>
      </section>
    </div>
  </section>

  <!-- Student full report modal -->
  <div class="overlay" id="studentOverlay" aria-hidden="true">
    <div class="modal">
      <div class="modalBody">
        <div class="dashTitle" id="studentModalTitle">Student Report</div>
        <div class="dashSub" id="studentModalSub"></div>
        <div id="studentModalBody" style="margin-top:12px;"></div>
        <div class="row" style="gap:10px; margin-top:14px;">
          <button class="primaryBtn" id="btnCloseStudentModal" type="button">Close</button>
        </div>
      </div>
    </div>
  </div>

</main>

<script src="./reports.js"></script>
</body>
</html>
